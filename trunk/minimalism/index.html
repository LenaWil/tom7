<!doctype html>
<script type="text/javascript" src="jsutil.js"></script>
<script type="text/javascript" src="constants.js"></script>

<script>
// TODO: Make mouse cursor invisible when it is outside the OS.


var mousex = 320, mousey = 200;
var os = null;
var mouse = null;
var deb = null;

function osmousemove(e) {
  var obj = getmouseposwithin(e, os);
  mousex = obj.x;
  mousey = obj.y;
  redrawmouse();
}

function redrawmouse() {
  mouse.style.top = px(mousey);
  mouse.style.left = px(mousex);
  // XXX set cursor style.

/*  
  deb.innerHTML = '';
  TEXT(mousex + ' ' + mousey + ' / ' +
       os.offsetTop, deb);
*/
}

function initos(elt) {
  os = elt;

  os.onmousemove = osmousemove;

  mouse = IMG('mouse', os);
  mouse.src = 'mouse.png';
  redrawmouse();
}

function Win(x, y, w, h) {
  this.x = x;
  this.y = y;
  this.w = w;
  this.h = h;

  this.div = DIV('win', os);
  this.redraw();
}

// Assuming the metrics are set (x,y,w,h),
// places the window in the DOM and
// draws its borders.
Win.prototype.redraw = function() {
  var d = this.div;
  d.innerHTML = '';
  d.style.left = this.x + 'px';
  d.style.top = this.y + 'px';
  d.style.width = this.w + 'px';
  d.style.height = this.h + 'px';

  // Add menu bar.
  this.title = DIV('title', this.div);
  this.title.style.width = px(this.w);
  this.title.style.height = px(TITLE);
  this.title.style.top = px(BORDER);
  this.title.style.left = 0;
  this.title.style.background = "url('title.png')";
  this.title.style.backgroundRepeat = 'repeat-x';

  TEXT('Program Manager', this.title);

  // Add borders and corners.

  this.west = DIV('border', this.div);
  this.west.style.width = px(BORDER);
  this.west.style.height = px(this.h);
  this.west.style.left = 0;
  this.west.style.top = 0;
  this.west.style.background = "url('border-vert.png')";
  this.west.style.backgroundRepeat = 'repeat-y';

  this.east = DIV('border', this.div);
  this.east.style.width = px(BORDER);
  this.east.style.height = px(this.h);
  this.east.style.left = px(this.w - BORDER);
  this.east.style.top = 0;
  this.east.style.background = "url('border-vert.png')";
  this.east.style.backgroundRepeat = 'repeat-y';

  this.north = DIV('border', this.div);
  this.north.style.width = px(this.w);
  this.north.style.height = px(BORDER);
  this.north.style.left = 0;
  this.north.style.top = 0;
  this.north.style.background = "url('border-horiz.png')";
  this.north.style.backgroundRepeat = 'repeat-x';

  this.south = DIV('border', this.div);
  this.south.style.width = px(this.w);
  this.south.style.height = px(BORDER);
  this.south.style.left = 0;
  this.south.style.top = px(this.h - BORDER);
  this.south.style.background = "url('border-horiz.png')";
  this.south.style.backgroundRepeat = 'repeat-x';

  this.nw = IMG('abs', this.div);
  this.nw.src = 'corner-nw.png';
  this.nw.style.left = 0;
  this.nw.style.top = 0;

  this.ne = IMG('abs', this.div);
  this.ne.src = 'corner-ne.png';
  this.ne.style.left = px(this.w - CORNER);
  this.ne.style.top = 0;

  this.sw = IMG('abs', this.div);
  this.sw.src = 'corner-sw.png';
  this.sw.style.left = 0;
  this.sw.style.top = px(this.h - CORNER);

  this.se = IMG('abs', this.div);
  this.se.src = 'corner-se.png';
  this.se.style.left = px(this.w - CORNER);
  this.se.style.top = px(this.h - CORNER);

  this.maximize = IMG('abs', this.div);
  this.maximize.src = 'maximize.png';
  this.maximize.style.left = px(this.w - TOOL - BORDER + 1);
  this.maximize.style.top = px(BORDER - 1);

  this.minimize = IMG('abs', this.div);
  this.minimize.src = 'minimize.png';
  this.minimize.style.left = px(this.w - (TOOL * 2) - BORDER + 1 + 1);
  this.minimize.style.top = px(BORDER - 1);

};

</script>


<style>
body {
  background: #300;
}

div.border {
  position: absolute;
}

div#os {
  width: 640px;
  height: 480px;
  background: #003;
  overflow: hidden;
  cursor: none;
  position: relative;
  margin-left: auto;
  margin-right: auto;
  margin-top: 6em;

  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

div.win {
  background: #fff;
  overflow: hidden;
  position: absolute;
}

img.abs {
  position: absolute;
}

div.title {
  position: absolute;
  text-align: center;
  font: bold 13px sans-serif;
  color: #fff;
}

img.mouse {
  z-index: 9999;
  position: absolute;
}

div#deb {
  font-family: monospace;
  font-size: 14px;
  color: #CFF;
}

</style>

<script>
function init() {
 // Don't allow dragging anything at the browser level.
 window.ondragstart = function() { return false; };
 deb = document.getElementById('deb');
 if (!deb) throw 'huh';

 initos(document.getElementById('os'));

 var win = new Win(10, 10, 320, 200);
 var win2 = new Win(80, 80, 400, 180);

 // XXX  do stuff...
}
</script>

<body onload="init()">
  <div id="os"></div>
  <div id="deb">This is the debugging area.</div>
</body>
